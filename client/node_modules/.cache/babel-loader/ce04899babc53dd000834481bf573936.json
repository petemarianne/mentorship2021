{"ast":null,"code":"var _jsxFileName = \"/Users/petemarianne/WebstormProjects/DogShop/src/pages/Main/Main.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from 'react';\nimport './Main.scss';\nimport { CircularProgress } from '@material-ui/core';\nimport Pagination from '@mui/material/Pagination';\nimport Stack from '@mui/material/Stack';\nimport { Link } from 'react-router-dom';\nimport { db } from '../../firebase';\nimport Filter from '../../components/Filter/Filter';\nimport { FilterContext } from '../../contexts/filter-context';\nimport { filterAds } from '../../utils/filterAds';\nimport { useScreenSize } from '../../hooks/useScreenSize';\nimport { toDate } from '../../utils/toDate';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Main = () => {\n  _s();\n\n  const [adsData, setAdsData] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [page, setPage] = useState(1);\n  const {\n    filter,\n    setFilterState\n  } = useContext(FilterContext);\n\n  const fetchAds = async () => {\n    const adsCollection = await db.collection('dogAds').get();\n    return adsCollection.docs.map(doc => {\n      return {\n        id: doc.data().id,\n        title: doc.data().title,\n        description: doc.data().description,\n        city: doc.data().city,\n        country: doc.data().country,\n        date: doc.data().date,\n        picture: doc.data().picture,\n        sellerID: doc.data().sellerID,\n        status: doc.data().status,\n        price: doc.data().price\n      };\n    });\n  };\n\n  const {\n    desktop\n  } = useScreenSize();\n\n  const comparator = (item1, item2) => {\n    if (item1.price === item2.price) {\n      return item2.date.seconds - item1.date.seconds;\n    }\n\n    switch (filter.sort) {\n      case 'dateDown':\n        return item2.date.seconds - item1.date.seconds;\n\n      case 'dateUp':\n        return item1.date.seconds - item2.date.seconds;\n\n      case 'priceDown':\n        return item2.price - item1.price;\n\n      case 'priceUp':\n        return item1.price - item2.price;\n\n      default:\n        return item2.date.seconds - item1.date.seconds;\n    }\n  };\n\n  const handleChange = (event, value) => {\n    setPage(value);\n  };\n\n  const filteredArray = adsData.filter(item => filterAds(item, filter));\n  const adWrapper = filteredArray.sort(comparator).map((item, index) => {\n    if (index < filteredArray.length && index >= (page - 1) * 10 && index < page * 10) {\n      return /*#__PURE__*/_jsxDEV(Link, {\n        to: `/ad${item.id.substring(2)}`,\n        style: {\n          textDecoration: 'none',\n          color: 'black'\n        },\n        className: loading ? 'ad-wrapper none' : 'ad-wrapper',\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pic-wrapper\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: item.picture,\n            alt: \"dog\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 72,\n            columnNumber: 50\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"info-wrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"breed\",\n            children: item.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"description\",\n            children: item.description\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 75,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price\",\n            children: [item.price, \"$\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 76,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"location-date-wrapper\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [item.city, \", \", item.country]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 78,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: toDate(item.date).toLocaleString('default', {\n                day: 'numeric',\n                month: 'short',\n                hour: 'numeric',\n                minute: 'numeric'\n              }).toLowerCase()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 79,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 21\n        }, this)]\n      }, index, true, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 17\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(React.Fragment, {}, `empty${index}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 20\n      }, this);\n    }\n  });\n\n  const pagination = /*#__PURE__*/_jsxDEV(Stack, {\n    spacing: 2,\n    children: /*#__PURE__*/_jsxDEV(Pagination, {\n      count: filteredArray.length % 10 === 0 ? filteredArray.length / 10 : Math.trunc(filteredArray.length / 10) + 1,\n      page: page,\n      onChange: handleChange,\n      onClick: () => {\n        document.body.scrollTop = 0;\n        document.documentElement.scrollTop = 0;\n      },\n      className: filteredArray.length <= 10 || loading ? 'pagination-wrapper none' : 'pagination-wrapper'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 9\n  }, this);\n\n  const loadingJSX = /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"loading-wrapper\",\n    children: /*#__PURE__*/_jsxDEV(CircularProgress, {\n      className: loading ? 'loading' : 'loading done'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 70\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 37\n  }, this);\n\n  useEffect(() => {\n    if (JSON.parse(localStorage.getItem('search'))) {\n      const breed = JSON.parse(localStorage.getItem('search')).breed;\n      setFilterState(currentFilter => ({ ...currentFilter,\n        breed\n      }));\n    }\n\n    localStorage.setItem('search', JSON.stringify({\n      breed: ''\n    }));\n    setLoading(true);\n    fetchAds().then(response => {\n      setAdsData(response);\n      setLoading(false);\n    });\n  }, [setFilterState]);\n  useEffect(() => {\n    setLoading(true);\n    setPage(1);\n    setTimeout(() => {\n      setLoading(false);\n    }, 1300);\n  }, [filter]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [desktop && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-page-desktop-wrapper\",\n      children: [/*#__PURE__*/_jsxDEV(Filter, {\n        isMenu: false\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"feed-wrapper\",\n        children: [loadingJSX, !loading && adsData.length !== 0 && filteredArray.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: 'nothing-found',\n          children: \"Nothing was found for your search!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 91\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false), adWrapper, pagination]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 17\n    }, this), !desktop && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-page-mobile-wrapper\",\n      children: [loadingJSX, !loading && adsData.length !== 0 && filteredArray.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: 'nothing-found',\n        children: \"Nothing was found for your search!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 87\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false), adWrapper, pagination]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Main, \"4w9t6c/57jLtotQwQbVhuaEkWOU=\", false, function () {\n  return [useScreenSize];\n});\n\n_c = Main;\nexport default Main;\n\nvar _c;\n\n$RefreshReg$(_c, \"Main\");","map":{"version":3,"sources":["/Users/petemarianne/WebstormProjects/DogShop/src/pages/Main/Main.tsx"],"names":["React","useState","useEffect","useContext","CircularProgress","Pagination","Stack","Link","db","Filter","FilterContext","filterAds","useScreenSize","toDate","Main","adsData","setAdsData","loading","setLoading","page","setPage","filter","setFilterState","fetchAds","adsCollection","collection","get","docs","map","doc","id","data","title","description","city","country","date","picture","sellerID","status","price","desktop","comparator","item1","item2","seconds","sort","handleChange","event","value","filteredArray","item","adWrapper","index","length","substring","textDecoration","color","toLocaleString","day","month","hour","minute","toLowerCase","pagination","Math","trunc","document","body","scrollTop","documentElement","loadingJSX","JSON","parse","localStorage","getItem","breed","currentFilter","setItem","stringify","then","response","setTimeout"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport './Main.scss';\nimport { CircularProgress } from '@material-ui/core';\nimport Pagination from '@mui/material/Pagination';\nimport Stack from '@mui/material/Stack';\nimport { Link } from 'react-router-dom';\nimport { db } from '../../firebase';\nimport Filter from '../../components/Filter/Filter';\nimport { FilterContext } from '../../contexts/filter-context';\nimport { filterAds } from '../../utils/filterAds';\nimport { useScreenSize } from '../../hooks/useScreenSize';\nimport { Ad } from '../../interfaces/Ad';\nimport { toDate } from '../../utils/toDate';\n\nconst Main: React.FC = (): JSX.Element => {\n    const [adsData, setAdsData] = useState<Ad[]>([]);\n    const [loading, setLoading] = useState<boolean>(true);\n    const [page, setPage] = useState<number>(1);\n\n    const {filter, setFilterState} = useContext(FilterContext);\n\n    const fetchAds = async () => {\n        const adsCollection = await db.collection('dogAds').get();\n        return adsCollection.docs.map((doc) => {return {\n            id: doc.data().id,\n            title: doc.data().title,\n            description: doc.data().description,\n            city: doc.data().city,\n            country: doc.data().country,\n            date: doc.data().date,\n            picture: doc.data().picture,\n            sellerID: doc.data().sellerID,\n            status: doc.data().status,\n            price: doc.data().price,\n        };});\n    };\n\n    const {desktop} = useScreenSize();\n\n    const comparator = (item1: Ad, item2: Ad): number => {\n        if (item1.price === item2.price) {\n            return item2.date.seconds - item1.date.seconds;\n        }\n        switch (filter.sort) {\n            case 'dateDown':\n                return item2.date.seconds - item1.date.seconds;\n            case 'dateUp':\n                return item1.date.seconds - item2.date.seconds;\n            case 'priceDown':\n                return item2.price - item1.price;\n            case 'priceUp':\n                return item1.price - item2.price;\n            default:\n                return item2.date.seconds - item1.date.seconds;\n        }\n    }\n\n    const handleChange = (event: React.ChangeEvent<unknown>, value: number): void => {\n        setPage(value);\n    };\n\n    const filteredArray: Ad[] = adsData.filter(item => filterAds(item, filter));\n    const adWrapper: JSX.Element[] = filteredArray.sort(comparator).map((item, index) => {\n        if (index < filteredArray.length && index >= (page - 1) * 10 && index < page * 10) {\n            return (\n                <Link\n                    to={`/ad${item.id.substring(2)}`}\n                    style={{ textDecoration: 'none', color: 'black'}}\n                    key={index}\n                    className={loading ? 'ad-wrapper none' : 'ad-wrapper'}\n                >\n                    <div className='pic-wrapper'><img src={item.picture} alt='dog'/></div>\n                    <div className='info-wrapper'>\n                        <div className='breed'>{item.title}</div>\n                        <div className='description'>{item.description}</div>\n                        <div className='price'>{item.price}$</div>\n                        <div className='location-date-wrapper'>\n                            <div>{item.city}, {item.country}</div>\n                            <div>{toDate(item.date).toLocaleString('default', {day: 'numeric', month: 'short', hour: 'numeric', minute: 'numeric'}).toLowerCase()}</div>\n                        </div>\n                    </div>\n                </Link>\n            );\n        } else {\n            return <React.Fragment key={`empty${index}`}/>;\n        }\n    });\n\n    const pagination: JSX.Element =\n        <Stack spacing={2}>\n            <Pagination\n                count={filteredArray.length % 10 === 0 ? filteredArray.length / 10 : Math.trunc(filteredArray.length / 10) + 1}\n                page={page}\n                onChange={handleChange}\n                onClick={() => {\n                    document.body.scrollTop = 0;\n                    document.documentElement.scrollTop = 0;\n                }}\n                className={filteredArray.length <= 10 || loading ? 'pagination-wrapper none' : 'pagination-wrapper'}/>\n        </Stack>;\n\n    const loadingJSX: JSX.Element = <div className='loading-wrapper'><CircularProgress className={loading ? 'loading' : 'loading done'}/></div>;\n\n    useEffect(() => {\n        if (JSON.parse(localStorage.getItem('search') as string)) {\n            const breed: string = JSON.parse(localStorage.getItem('search') as string).breed;\n            setFilterState((currentFilter) => ({\n                ...currentFilter,\n                breed,\n            }))\n        }\n        localStorage.setItem('search', JSON.stringify({breed: ''}));\n        setLoading(true);\n        fetchAds().then((response) => {\n            setAdsData(response);\n            setLoading(false);\n        })\n    }, [setFilterState]);\n\n    useEffect(() => {\n        setLoading(true);\n        setPage(1);\n        setTimeout(() => {\n            setLoading(false);\n        }, 1300)\n    }, [filter]);\n\n    return (\n        <>\n            {desktop && (\n                <div className='main-page-desktop-wrapper'>\n                    <Filter isMenu={false}/>\n                    <div className='feed-wrapper'>\n                        {loadingJSX}\n                        {!loading && adsData.length !== 0 && filteredArray.length === 0 ? <div className={'nothing-found'}>Nothing was found for your search!</div> : <></>}\n                        {adWrapper}\n                        {pagination}\n                    </div>\n                </div>\n            )}\n            {!desktop && (\n                <div className='main-page-mobile-wrapper'>\n                    {loadingJSX}\n                    {!loading && adsData.length !== 0 && filteredArray.length === 0 ? <div className={'nothing-found'}>Nothing was found for your search!</div> : <></>}\n                    {adWrapper}\n                    {pagination}\n                </div>\n            )}\n        </>\n    );\n};\n\nexport default Main;\n"]},"metadata":{},"sourceType":"module"}