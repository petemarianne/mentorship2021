{"ast":null,"code":"var _jsxFileName = \"/Users/petemarianne/WebstormProjects/DogShop/src/components/AdFormModal/AdFormModal.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport './AdFormModal.scss';\nimport { Button, CircularProgress, IconButton, InputBase } from '@material-ui/core';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { app, db } from '../../firebase';\nimport { toDate } from '../../utils/toDate.ts';\nimport { validateAd } from '../../utils/validateAd';\nimport { v4 as uuidv4 } from 'uuid';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const AdFormModal = ({\n  handleClose\n}) => {\n  _s();\n\n  const [loading, setLoading] = useState(false);\n  const [adsData, setAdsData] = useState([]);\n  const [user, setUser] = useState({});\n  const [validate, setValidate] = useState(true);\n  const [file, setFile] = useState({});\n  const [drag, setDrag] = useState(false);\n  const [uploaded, setUploaded] = useState(false);\n  const [fields, setFields] = useState({\n    title: '',\n    country: '',\n    city: '',\n    description: '',\n    price: ''\n  });\n\n  const fetchAds = async () => {\n    const adsCollection = await db.collection('dogAds').get();\n    const ads = adsCollection.docs.map(doc => {\n      return doc.data();\n    });\n    return Promise.resolve(ads);\n  };\n\n  const fetchUser = async () => {\n    const usersCollection = await db.collection('users').where('id', '==', 'seller1').get();\n    const user = usersCollection.docs.map(doc => {\n      return doc.data();\n    })[0];\n    return Promise.resolve(user);\n  };\n\n  useEffect(() => {\n    fetchAds().then(response => {\n      setAdsData(response);\n    });\n    fetchUser().then(response => {\n      setUser(response);\n    });\n  }, []);\n\n  const dragStartHandle = event => {\n    event.preventDefault();\n    setDrag(true);\n  };\n\n  const dragLeaveHandle = event => {\n    event.preventDefault();\n    setDrag(false);\n  };\n\n  const onDropHandler = event => {\n    event.preventDefault();\n    const file = event.dataTransfer.files[0];\n    setFile(file);\n    setDrag(false);\n    setUploaded(true);\n  };\n\n  const onFileChange = async event => {\n    const file = event.target.files[0];\n    setFile(file);\n    setDrag(false);\n    setUploaded(true);\n  };\n\n  const publish = async () => {\n    const storageRef = app.storage().ref();\n    const fileRef = storageRef.child(file.name);\n    await fileRef.put(file);\n    const fileUrl = await fileRef.getDownloadURL();\n    await db.collection('dogAds').doc(uuidv4()).set({ ...fields,\n      picture: fileUrl,\n      date: new Date(),\n      status: 'active',\n      sellerID: user.id,\n      id: 'ad' + (adsData.length + 1)\n    });\n    await db.collection('users').doc(user.name).set({ ...user,\n      activeAds: user.activeAds + 1,\n      date: toDate(user.date)\n    });\n    handleClose();\n  };\n\n  const handleTitle = event => {\n    setFields(current => ({ ...current,\n      title: event.target.value\n    }));\n  };\n\n  const handleCountry = event => {\n    setFields(current => ({ ...current,\n      country: event.target.value\n    }));\n  };\n\n  const handleCity = event => {\n    setFields(current => ({ ...current,\n      city: event.target.value\n    }));\n  };\n\n  const handleDescription = event => {\n    setFields(current => ({ ...current,\n      description: event.target.value\n    }));\n  };\n\n  const handlePrice = event => {\n    setFields(current => ({ ...current,\n      price: event.target.value\n    }));\n  };\n\n  const uploadedJSX = /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Uploaded!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"file-name\",\n      children: file.name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      component: \"label\",\n      className: \"re-upload-file-button\",\n      children: [\"Upload Another File\", /*#__PURE__*/_jsxDEV(\"input\", {\n        \"data-testid\": \"upload-another-file\",\n        type: \"file\",\n        onChange: onFileChange,\n        hidden: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n\n  const dragJSX = /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Drag a picture!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"or\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      component: \"label\",\n      className: \"upload-file-button\",\n      \"data-testid\": \"upload-button\",\n      children: [\"Upload File\", /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        onChange: onFileChange,\n        hidden: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n\n  const dropJSX = /*#__PURE__*/_jsxDEV(\"div\", {\n    children: \"Drop a picture!\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 136,\n    columnNumber: 21\n  }, this);\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"new-ad-modal\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"close-icon-button-wrapper\",\n      children: /*#__PURE__*/_jsxDEV(IconButton, {\n        id: \"modal-close-button\",\n        \"aria-label\": \"lose\",\n        size: \"medium\",\n        onClick: handleClose,\n        \"data-testid\": \"close-button\",\n        children: /*#__PURE__*/_jsxDEV(CloseIcon, {\n          fontSize: \"medium\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-header\",\n      children: \"NEW AD FORM\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: event => {\n        event.preventDefault();\n\n        if (validateAd(file, fields)) {\n          setLoading(true);\n          publish().then(() => {\n            setLoading(false);\n          });\n        } else {\n          setValidate(false);\n        }\n      },\n      \"data-testid\": \"form\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"filter-name\",\n        children: \"Title\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"input\",\n        children: /*#__PURE__*/_jsxDEV(InputBase, {\n          value: fields.title,\n          onChange: handleTitle,\n          \"data-testid\": \"text-input\",\n          fullWidth: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"location-input\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"filter-name country\",\n            children: \"Country\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"input country\",\n            children: /*#__PURE__*/_jsxDEV(InputBase, {\n              value: fields.country,\n              onChange: handleCountry,\n              \"data-testid\": \"text-input\",\n              fullWidth: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 163,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"filter-name city\",\n            children: \"City\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"input city\",\n            children: /*#__PURE__*/_jsxDEV(InputBase, {\n              value: fields.city,\n              onChange: handleCity,\n              \"data-testid\": \"text-input\",\n              fullWidth: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"filter-name\",\n        children: \"Description\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"input description\",\n        children: /*#__PURE__*/_jsxDEV(InputBase, {\n          value: fields.description,\n          onChange: handleDescription,\n          maxRows: 7,\n          \"data-testid\": \"text-input\",\n          multiline: true,\n          fullWidth: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"filter-name\",\n        children: \"Price\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"price-input-picture-button-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"price-input-button-wrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"input price\",\n            children: /*#__PURE__*/_jsxDEV(InputBase, {\n              value: fields.price,\n              onChange: handlePrice,\n              \"data-testid\": \"text-input\",\n              fullWidth: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 25\n          }, this), validate ? null : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"validate-attention\",\n            \"data-testid\": \"validate\",\n            children: \"Fill in all the fields!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 44\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            type: \"submit\",\n            className: \"publish-button\",\n            variant: \"contained\",\n            color: \"primary\",\n            \"data-testid\": \"publish-button\",\n            children: !loading ? 'Publish' : /*#__PURE__*/_jsxDEV(CircularProgress, {\n              color: \"inherit\",\n              size: \"25px\",\n              \"data-testid\": \"loading\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 53\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          onDragStart: dragStartHandle,\n          onDragLeave: dragLeaveHandle,\n          onDragOver: dragStartHandle,\n          onDrop: drag ? onDropHandler : null,\n          className: \"drag-and-drop-wrapper\",\n          style: drag ? {\n            padding: '55px 0'\n          } : null,\n          \"data-testid\": \"drug-and-drop-area\",\n          children: drag ? dropJSX : uploaded ? uploadedJSX : dragJSX\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 139,\n    columnNumber: 9\n  }, this);\n};\n\n_s(AdFormModal, \"HrtOK+Zk61q140hI/V5GuhnXcQU=\");\n\n_c = AdFormModal;\nAdFormModal.propTypes = {\n  handleClose: PropTypes.func\n};\n\nvar _c;\n\n$RefreshReg$(_c, \"AdFormModal\");","map":{"version":3,"sources":["/Users/petemarianne/WebstormProjects/DogShop/src/components/AdFormModal/AdFormModal.jsx"],"names":["React","useEffect","useState","PropTypes","Button","CircularProgress","IconButton","InputBase","CloseIcon","app","db","toDate","validateAd","v4","uuidv4","AdFormModal","handleClose","loading","setLoading","adsData","setAdsData","user","setUser","validate","setValidate","file","setFile","drag","setDrag","uploaded","setUploaded","fields","setFields","title","country","city","description","price","fetchAds","adsCollection","collection","get","ads","docs","map","doc","data","Promise","resolve","fetchUser","usersCollection","where","then","response","dragStartHandle","event","preventDefault","dragLeaveHandle","onDropHandler","dataTransfer","files","onFileChange","target","publish","storageRef","storage","ref","fileRef","child","name","put","fileUrl","getDownloadURL","set","picture","date","Date","status","sellerID","id","length","activeAds","handleTitle","current","value","handleCountry","handleCity","handleDescription","handlePrice","uploadedJSX","dragJSX","dropJSX","padding","propTypes","func"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport './AdFormModal.scss';\nimport { Button, CircularProgress, IconButton, InputBase } from '@material-ui/core';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { app, db } from '../../firebase';\nimport { toDate } from '../../utils/toDate.ts';\nimport { validateAd } from '../../utils/validateAd';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport const AdFormModal = ({handleClose}) => {\n    const [loading, setLoading] = useState(false);\n    const [adsData, setAdsData] = useState([]);\n    const [user, setUser] = useState({});\n    const [validate, setValidate] = useState(true);\n    const [file, setFile] = useState({});\n    const [drag, setDrag] = useState(false);\n    const [uploaded, setUploaded] = useState(false);\n    const [fields, setFields] = useState(\n        {\n            title: '',\n            country: '',\n            city: '',\n            description: '',\n            price: '',\n        }\n    )\n\n    const fetchAds = async () => {\n        const adsCollection = await db.collection('dogAds').get();\n        const ads = adsCollection.docs.map((doc) => {return doc.data();});\n        return Promise.resolve(ads);\n    };\n\n    const fetchUser = async () => {\n        const usersCollection = await db.collection('users').where('id','==','seller1').get();\n        const user = usersCollection.docs.map((doc) => {return doc.data();})[0];\n        return Promise.resolve(user);\n    };\n\n    useEffect(() => {\n        fetchAds().then((response) => {\n            setAdsData(response);\n        });\n        fetchUser().then((response) => {\n            setUser(response);\n        });\n    }, []);\n\n    const dragStartHandle = (event) => {\n        event.preventDefault();\n        setDrag(true);\n    }\n\n    const dragLeaveHandle = (event) => {\n        event.preventDefault();\n        setDrag(false);\n    }\n\n    const onDropHandler = (event) => {\n        event.preventDefault();\n        const file = event.dataTransfer.files[0];\n        setFile(file);\n        setDrag(false);\n        setUploaded(true);\n    }\n\n    const onFileChange = async (event) => {\n        const file = event.target.files[0];\n        setFile(file);\n        setDrag(false);\n        setUploaded(true);\n    };\n\n    const publish = async () => {\n        const storageRef = app.storage().ref();\n        const fileRef = storageRef.child(file.name);\n        await fileRef.put(file);\n        const fileUrl = await fileRef.getDownloadURL();\n        await db.collection('dogAds').doc(uuidv4()).set({\n            ...fields,\n            picture: fileUrl,\n            date: new Date(),\n            status: 'active',\n            sellerID: user.id,\n            id: 'ad' + (adsData.length + 1),\n        });\n        await db.collection('users').doc(user.name).set({\n            ...user,\n            activeAds: user.activeAds + 1,\n            date: toDate(user.date),\n        });\n        handleClose();\n    };\n\n    const handleTitle = (event) => {\n        setFields(current => ({...current, title: event.target.value}));\n    }\n\n    const handleCountry = (event) => {\n        setFields(current => ({...current, country: event.target.value}));\n    }\n\n    const handleCity = (event) => {\n        setFields(current => ({...current, city: event.target.value}));\n    }\n\n    const handleDescription = (event) => {\n        setFields(current => ({...current, description: event.target.value}));\n    }\n\n    const handlePrice = (event) => {\n        setFields(current => ({...current, price: event.target.value}));\n    }\n\n    const uploadedJSX =\n        <>\n            <div>Uploaded!</div>\n            <div className='file-name'>{file.name}</div>\n            <Button variant='contained' color='primary' component='label' className='re-upload-file-button'>\n                Upload Another File\n                <input data-testid='upload-another-file' type='file' onChange={onFileChange} hidden/>\n            </Button>\n        </>;\n\n    const dragJSX =\n        <>\n            <div>Drag a picture!</div>\n            <div>or</div>\n            <Button variant='contained' color='primary' component='label' className='upload-file-button' data-testid='upload-button'>\n                Upload File\n                <input type='file' onChange={onFileChange} hidden/>\n            </Button>\n        </>;\n\n    const dropJSX = <div>Drop a picture!</div>;\n\n    return (\n        <div className='new-ad-modal'>\n            <div className='close-icon-button-wrapper'>\n                <IconButton id='modal-close-button' aria-label='lose' size='medium' onClick={handleClose} data-testid='close-button'>\n                    <CloseIcon fontSize='medium'/>\n                </IconButton>\n            </div>\n            <div className='modal-header'>NEW AD FORM</div>\n            <form onSubmit={(event) => {\n                event.preventDefault();\n                if (validateAd(file, fields)) {\n                    setLoading(true);\n                    publish().then(() => {setLoading(false)});\n                } else {\n                    setValidate(false)\n                }\n            }} data-testid='form'>\n                <div className='filter-name'>Title</div>\n                <div className='input'>\n                    <InputBase value={fields.title} onChange={handleTitle} data-testid='text-input' fullWidth/>\n                </div>\n                <div className='location-input'>\n                    <div>\n                        <div className='filter-name country'>Country</div>\n                        <div className='input country'>\n                            <InputBase value={fields.country} onChange={handleCountry} data-testid='text-input' fullWidth/>\n                        </div>\n                    </div>\n                    <div>\n                        <div className='filter-name city'>City</div>\n                        <div className='input city'>\n                            <InputBase value={fields.city} onChange={handleCity} data-testid='text-input' fullWidth/>\n                        </div>\n                    </div>\n                </div>\n                <div className='filter-name'>Description</div>\n                <div className='input description'>\n                    <InputBase value={fields.description} onChange={handleDescription} maxRows={7} data-testid='text-input' multiline fullWidth/>\n                </div>\n                <div className='filter-name'>Price</div>\n                <div className='price-input-picture-button-wrapper'>\n                    <div className='price-input-button-wrapper'>\n                        <div className='input price'>\n                            <InputBase value={fields.price} onChange={handlePrice} data-testid='text-input' fullWidth/>\n                        </div>\n                        {validate ? null : <div className='validate-attention' data-testid='validate'>Fill in all the fields!</div>}\n                        <Button\n                            type='submit'\n                            className='publish-button'\n                            variant='contained'\n                            color='primary'\n                            data-testid='publish-button'\n                        >\n                            {!loading ? 'Publish' : <CircularProgress color='inherit' size='25px' data-testid='loading'/>}\n                        </Button>\n                    </div>\n                    <div onDragStart={dragStartHandle}\n                         onDragLeave={dragLeaveHandle}\n                         onDragOver={dragStartHandle}\n                         onDrop={drag ? onDropHandler : null}\n                         className='drag-and-drop-wrapper'\n                         style={drag ? {padding: '55px 0'} : null}\n                         data-testid='drug-and-drop-area'\n                    >\n                        {drag ?  dropJSX : uploaded ? uploadedJSX : dragJSX}\n                    </div>\n                </div>\n            </form>\n        </div>\n    );\n};\n\nAdFormModal.propTypes = {\n    handleClose: PropTypes.func,\n};\n"]},"metadata":{},"sourceType":"module"}